<template>
  <div id="nav">
    <router-link id="website-name" to="/" :key="$route.fullPath"
      ><div class="logo">
        <svg viewBox="0 0 370.1851851851852 65.09601468555904">
          <defs></defs>
          <g
            featurekey="symbolFeature-0"
            transform="matrix(0.6499511437220108,0,0,0.6499511437220108,0,-0.0006495074036402862)"
            fill="#ffffff"
          >
            <g xmlns="http://www.w3.org/2000/svg">
              <path
                d="M10.264,78.058c0.875-8.288,3.61-17.697,7.315-25.168c3.003-6.058,7.813-13.275,13.694-13.32   c0.221-0.02,0.442-0.03,0.661-0.03c2.152,0,5.18,0.976,7.756,5.44c1.243,0.281,2.776,0.439,4.582,0.475V2.743   c0-1.515-1.19-2.742-2.66-2.742H2.66C1.191,0,0,1.228,0,2.743v85.181c0,1.514,1.191,2.742,2.66,2.742h7.961   C9.888,87.122,9.754,82.889,10.264,78.058z M8.388,57.972c-1.056,0-1.911-1.219-1.911-2.723V9.089c0-1.504,0.855-2.723,1.911-2.723   h1.279c1.055,0,1.911,1.219,1.911,2.723v46.16c0,1.504-0.856,2.723-1.911,2.723H8.388z"
              ></path>
              <g>
                <path
                  d="M38.365,47.297c-0.748-0.209-1.53-2.164-2.095-2.838c-0.742-0.881-1.651-1.655-2.729-2.05    c-2.841-1.041-5.674,0.624-7.666,2.611c-4.907,4.901-7.825,12.13-9.95,18.697c-2.587,8.002-4.504,17.132-3.032,25.565    c0.078,0.466,0.172,0.925,0.277,1.384c1.232,5.404,6.798,12.676,12.49,7.981c4.835-3.906,7.592-10.887,10.066-16.474    c0.525-1.16,1.032-2.329,1.553-3.493c0.262-0.575,0.523-1.157,0.829-1.711c0.473-0.873,0.772-0.755,1.787-0.755    c5.66,0,11.319,0,16.979,0c2.8,0,5.601,0,8.402,0c1.4,0,2.799,0,4.199,0c0.701,0,1.401,0,2.102,0c0.904,0,2.099-0.464,2.099,0.644    c0.21,2.835,1.264,5.648,2.436,8.194c2.303,4.998,5.665,10.4,10.377,13.304c5.321,3.31,9.705-0.195,11.616-5.575    c2.398-6.745,1.731-14.619,0.551-21.547c-1.247-7.321-3.385-14.81-7.055-21.254c-1.897-3.334-4.485-6.574-8.122-7.924    c-3.101-1.168-6.519-0.504-8.707,2.136c-0.58,0.693-1.054,1.486-1.43,2.313c-0.543,1.19-2.143,1.094-3.356,1.231    C66.455,48.136,43.604,48.767,38.365,47.297z M40.931,64.388h-6.056v6.242h-6.682v-6.242h-6.056v-6.889h6.056v-6.244h6.682v6.244    h6.056V64.388z M81.007,52.953c1.73,0,3.134,1.446,3.134,3.231c0,1.784-1.403,3.23-3.134,3.23c-1.731,0-3.134-1.446-3.134-3.23    C77.873,54.399,79.275,52.953,81.007,52.953z M75.071,65.534c-1.73,0-3.134-1.446-3.134-3.23c0-1.785,1.403-3.231,3.134-3.231    c1.731,0,3.134,1.446,3.134,3.231C78.205,64.088,76.803,65.534,75.071,65.534z M81.007,71.652c-1.731,0-3.134-1.447-3.134-3.23    c0-1.784,1.402-3.231,3.134-3.231c1.73,0,3.134,1.447,3.134,3.231C84.141,70.205,82.737,71.652,81.007,71.652z M86.942,65.534    c-1.731,0-3.135-1.446-3.135-3.23c0-1.785,1.403-3.231,3.135-3.231c1.73,0,3.134,1.446,3.134,3.231    C90.076,64.088,88.673,65.534,86.942,65.534z"
                ></path>
              </g>
            </g>
          </g>
          <g
            featurekey="nameFeature-0"
            transform="matrix(1.2084632921125638,0,0,1.2084632921125638,85,2.253735325490963)"
            fill="#ffffff"
          >
            <path
              d="M7.56 40.36 c-2.5067 0 -4.3932 -0.71332 -5.66 -2.14 s-1.9 -3.4867 -1.9 -6.18 l0 -14 c0 -2.7467 0.64 -4.82 1.92 -6.22 s3.2933 -2.1 6.04 -2.1 c2.5867 0 4.5068 0.70668 5.76 2.12 s1.88 3.4533 1.88 6.12 l0 2.8 l-3.48 0 l0 -3.2 c0 -0.58668 -0.06 -1.16 -0.18 -1.72 s-0.34 -1.06 -0.66 -1.5 s-0.75332 -0.79332 -1.3 -1.06 s-1.2467 -0.4 -2.1 -0.4 s-1.5666 0.12 -2.14 0.36 s-1.0333 0.58 -1.38 1.02 s-0.58668 0.98 -0.72 1.62 s-0.2 1.36 -0.2 2.16 l0 14.16 c0 1.6267 0.3 2.84 0.9 3.64 s1.7 1.2 3.3 1.2 c1.76 0 2.96 -0.42 3.6 -1.26 s0.96 -1.9933 0.96 -3.46 l0 -4.8 l-5.64 -0.04 l0 -3.4 l9.04 0.04 l0 7.92 c0 2.72 -0.62 4.7868 -1.86 6.2 s-3.3 2.12 -6.18 2.12 z M35.335 40 l-2.04 -8.36 l-7.76 0 l-2.04 8.36 l-3.4 0 l8 -30 l2.76 0 l7.96 30 l-3.48 0 z M29.535000000000004 15.8 l-3.16 12.44 l6.08 0 z M60.67 40 l0 -21 l-5.4 13.28 l-3.12 -0.04 l-5.24 -13.16 l0 20.92 l-3.36 0 l0 -30 l3.24 0 l6.96 17.24 l7.04 -17.24 l3.24 0 l0 30 l-3.36 0 z M71.045 40 l0 -30 l14.72 0 l0 3.76 l-11.36 0 l0 9.24 l11.28 0 l0 3.32 l-11.28 0 l0 9.92 l11.64 0 l0 3.76 l-15 0 z M100.58000000000001 13.64 l0 26.36 l-3.6 0 l0 -26.36 l-5.88 0 l0 -3.64 l15.36 0 l0 3.64 l-5.88 0 z M125.79500000000002 40 l-6 -11.8 l-4.36 0 l0 11.8 l-3.32 0 l0 -30 l6.96 0 c1.5733 0 2.92 0.24668 4.04 0.74 s2.04 1.16 2.76 2 s1.2533 1.8 1.6 2.88 s0.52 2.2067 0.52 3.38 c0 0.93332 -0.11332 1.84 -0.34 2.72 s-0.55336 1.6933 -0.98004 2.44 s-0.92668 1.42 -1.5 2.02 s-1.1933 1.0733 -1.86 1.42 l6.68 12.4 l-4.2 0 z M118.83500000000001 13.32 l-3.4 0.000039062 l0 11.4 l3.64 0 c1.0933 0 1.9933 -0.16668 2.7 -0.5 s1.26 -0.77332 1.66 -1.32 s0.68 -1.1734 0.84 -1.88 s0.24 -1.4467 0.24 -2.22 s-0.12668 -1.4933 -0.38 -2.16 s-0.62 -1.2467 -1.1 -1.74 s-1.0733 -0.88 -1.78 -1.16 s-1.5134 -0.42 -2.42 -0.42 z M149.21 40 l-2.04 -8.36 l-7.76 0 l-2.04 8.36 l-3.4 0 l8 -30 l2.76 0 l7.96 30 l-3.48 0 z M143.41 15.8 l-3.16 12.44 l6.08 0 z M170.625 32.08 c-0.02668 1.36 -0.15992 2.5533 -0.39992 3.58 s-0.63332 1.8867 -1.18 2.58 s-1.2734 1.22 -2.18 1.58 s-2.04 0.54 -3.4 0.54 c-2.3733 0 -4.1132 -0.71332 -5.22 -2.14 s-1.66 -3.4867 -1.66 -6.18 l0 -14 c0 -2.7467 0.56 -4.82 1.68 -6.22 s2.9733 -2.1 5.56 -2.1 c2.4 0 4.12 0.71332 5.16 2.14 s1.5867 3.4734 1.64 6.14 l0.04 2.56 l-3.12 0 l-0.04 -3 c0 -0.58668 -0.05332 -1.1667 -0.16 -1.74 s-0.29336 -1.0733 -0.56004 -1.5 s-0.64 -0.77336 -1.12 -1.04 s-1.12 -0.4 -1.92 -0.4 c-1.5733 0 -2.6333 0.46 -3.18 1.38 s-0.82 2.18 -0.82 3.78 l0.04 14.2 c0 1.6267 0.26 2.8334 0.78 3.62 s1.4867 1.18 2.9 1.18 c0.8 0 1.46 -0.10668 1.98 -0.32 s0.93332 -0.52 1.24 -0.92 s0.52 -0.89332 0.64 -1.48 s0.18 -1.2534 0.18 -2 l0.04 -3.24 l3.12 0 z M188.96 40 l-6.04 -14.56 l-2.76 4.4 l0 10.16 l-3.32 0 l0 -30 l3.32 0 l0 13.08 l8 -13.08 l3.96 0 l-6.84 12.36 l7.4 17.64 l-3.72 0 z M197.85500000000002 40 l0 -30 l14.72 0 l0 3.76 l-11.36 0 l0 9.24 l11.28 0 l0 3.32 l-11.28 0 l0 9.92 l11.64 0 l0 3.76 l-15 0 z M231.79000000000002 40 l-6 -11.8 l-4.36 0 l0 11.8 l-3.32 0 l0 -30 l6.96 0 c1.5733 0 2.92 0.24668 4.04 0.74 s2.04 1.16 2.76 2 s1.2533 1.8 1.6 2.88 s0.52 2.2067 0.52 3.38 c0 0.93332 -0.11332 1.84 -0.34 2.72 s-0.55336 1.6933 -0.98004 2.44 s-0.92668 1.42 -1.5 2.02 s-1.1933 1.0733 -1.86 1.42 l6.68 12.4 l-4.2 0 z M224.83 13.32 l-3.4 0.000039062 l0 11.4 l3.64 0 c1.0933 0 1.9933 -0.16668 2.7 -0.5 s1.26 -0.77332 1.66 -1.32 s0.68 -1.1734 0.84 -1.88 s0.24 -1.4467 0.24 -2.22 s-0.12668 -1.4933 -0.38 -2.16 s-0.62 -1.2467 -1.1 -1.74 s-1.0733 -0.88 -1.78 -1.16 s-1.5134 -0.42 -2.42 -0.42 z"
            ></path>
          </g>
        </svg></div
    ></router-link>
    <div id="secondary-nav">
      <router-link
        v-if="logged"
        :to="{ name: 'profile', params: { id: $store.state.user_id } }"
        :key="$route.fullPath"
        ><i class="fas fa-user"></i> Profile</router-link
      >
      <router-link to="/community" :key="$route.fullPath"
        ><i class="fas fa-users"></i> Community</router-link
      >

      <router-link to="/games" :key="$route.fullPath"
        ><i class="fas fa-gamepad"></i> Games</router-link
      >
      <!--:key="$route.fullPath" FORÇA A rota a renderizar de novo-->
      <router-link v-if="!logged" to="/login"
        ><i class="fas fa-sign-in-alt"></i> Login</router-link
      >
      <router-link v-if="!logged" to="/register"
        ><i class="fas fa-user-plus"></i> Register</router-link
      >
      <a @click="logout" v-if="logged"
        ><i class="fas fa-sign-out-alt"></i> Logout</a
      >
    </div>
    <div id="nav-burger" v-if="!showMenu" @click="toggleMenu">
      <i class="fas fa-bars"></i>
    </div>
    <div id="display-burger" v-if="showMenu">
      <div id="nav-close" v-if="showMenu" @click="toggleMenu">
        <i class="fas fa-times"></i>
      </div>

      <div class="links-container">
        <router-link
          @click="toggleMenu"
          v-if="logged"
          :to="{ name: 'profile', params: { id: $store.state.user_id } }"
          :key="$route.fullPath"
          ><i class="fas fa-user"></i> Profile</router-link
        >
        <router-link @click="toggleMenu" to="/community" :key="$route.fullPath"
          ><i class="fas fa-users"></i> Community</router-link
        >
        <router-link @click="toggleMenu" to="/games" :key="$route.fullPath"
          ><i class="fas fa-gamepad"></i> Games</router-link
        >
        <!--:key="$route.fullPath" FORÇA A rota a renderizar de novo-->
        <router-link @click="toggleMenu" v-if="!logged" to="/login"
          ><i class="fas fa-sign-in-alt"></i> Login</router-link
        >
        <router-link @click="toggleMenu" v-if="!logged" to="/register"
          ><i class="fas fa-user-plus"></i> Register</router-link
        >
        <a @click="logout" v-if="logged"
          ><i class="fas fa-sign-out-alt"></i> Logout</a
        >
      </div>
    </div>
  </div>
</template>

<script>
import axios from "axios";
import { mapMutations } from "vuex";

export default {
  name: "Navbar",

  data() {
    return {
      showMenu: false,
    };
  },
  computed: {
    //esse logged é chamado semrpe pq temos um v-if no router link que "checa" o status dele, se mudar vai alterar
    logged() {
      return this.$store.state.logged;
    },
  },
  methods: {
    ...mapMutations(["logout"]),
    toggleMenu() {
      this.showMenu = !this.showMenu;
    },
    logout() {
      this.showMenu = false;
      this.deleteTokenDatabase();
      this.$store.commit("logout");
      this.$router.push({
        path: "/",
        query: {
          messageLogout:
            "Your logout was successful. Come back soon to track and review your games on GameTracker!",
        },
        key: this.$route.fullPath,
      });
    },
    username(name) {
      this.userName = name;
    },
    async deleteTokenDatabase() {
      //removes token from database
      const user_id = this.$store.state.user_id;
      const personal_token = this.$store.state.personal_token;
      try {
        const response = await axios.delete(
          `${process.env.VUE_APP_APIURL}logout`,
          {
            params: {
              user_id: user_id,
            },
            headers: {
              Authorization: `Bearer ${personal_token}`,
            },
          }
        );
        console.log(response.data);
      } catch (error) {
        console.log(error.response.data.error);
      }
    },
  },
};
</script>

<style scoped>
.logo {
  display: flex;
  align-content: center;
  justify-content: center;
}
.logo svg {
  width: 20vh;
}
#nav {
  width: 100%;
  background-color: #6842ff;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  padding: 15px 50px;
}
#nav-burger {
  display: none;
  font-size: 4vh;
}
#nav #website-name {
  font-size: 32px;
  font-weight: 800;
  margin: auto;
  margin-left: 0;
  color: #fff;
}
#nav a {
  color: #fff;
  text-decoration: none;
  margin: 10px;
  transition: 0.4s;
  cursor: pointer;
}
#nav a:hover {
  color: #161b3a;
}
#nav a.router-link-exact-active {
  color: #161b3a;
}
@media screen and (max-width: 768px) {
  #nav-close {
    position: fixed;
    top: 2.7vh;
    right: 13vw;
    z-index: 9999;
    font-size: 4vh;
  }
  #secondary-nav {
    display: none;
  }
  #nav-burger {
    display: block;
  }
  #display-burger {
    position: absolute;
    background-color: #161b3a;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: 999;
    opacity: 95%;
  }
  #display-burger a.router-link-exact-active {
    color: #6842ff;
  }
  .links-container {
    position: fixed;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    gap: 10vh;
    font-size: 3vh;
  }
}
</style>
